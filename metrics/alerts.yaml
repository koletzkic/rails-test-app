groups:
  - name: basic_alerts
    rules:

      - alert: RedisDown
        expr: redis_up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Redis is down"
          description: "Redis exporter reported redis_up == 0"

      - alert: PostgresDown
        expr: pg_up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "PostgreSQL is down"
          description: "Postgres exporter reported pg_up == 0"

      - alert: HighPostgresConnections
        expr: pg_stat_activity_count > 80
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High number of PostgreSQL connections"
          description: "Active connections over 80: {{ $value }}"

      - alert: HighRedisMemoryUsage
        expr: redis_memory_used_bytes / redis_config_maxmemory_bytes > 0.9
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Redis memory usage over 90%"
          description: "Memory usage high: {{ $value }}"

      - alert: RailsHighHttpLatency
        expr: avg_over_time(http_server_duration_seconds_sum[5m]) / avg_over_time(http_server_duration_seconds_count[5m]) > 1.5
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High Rails request latency"
          description: "Average request latency > 1.5s for the past 5 minutes"